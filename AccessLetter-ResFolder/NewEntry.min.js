function init(){var e=$(".ms-signInLink")[0];void 0!=e&&"Sign In"===e.innerHTML&&window.open(_spPageContextInfo.siteAbsoluteUrl+"/_layouts/15/Authenticate.aspx?Source="+window.location.pathname,"_self",!0),$("#txt_VCount").focusout(function(e){parseInt($(this).val())>0?(excelTab=$("#excelControl").empty().xtab("init",{rows:this.value,cols:3,collabels:!1,rowlabels:!1,widths:[159,159,159]}),$(".hideComp").css("visibility","visible")):($(".hideComp").css("visibility","hidden"),alert("Must enter a number to continue"))}),$("#txt_vMultiLine").focusout(function(e){var t=0,n=$("#txt_vMultiLine").val(),a=n.split("\n");for(var i in a){var l=a[i].split("\t");for(var o in l)$("#excelControl-"+t+"-"+o).val(l[o]);t++}$("#txt_vMultiLine").val("")}),$("input[type=radio][name=Diligence]").change(function(){"Yes"===this.value&&alert("Please be aware that you may only share VDD reports in the second round of a sales process and with a maximum of 6 bidders.\n\nIf you have any questions or concerns about this, please contact a member of the EMEA legal team")}),$("#btn_Send").on("click",function(){context=new SP.ClientContext.get_current,currentUser=context.get_web().get_currentUser(),context.load(currentUser),context.executeQueryAsync(function(){SubmitData(excelTab.xtab("val"))},function(e,t){alert("Error getting current user email.. "+t.get_message())})})}function SubmitData(e){var t=[],n=0,a=!0,i=!1,l="\n";if(0===$("#txt_CaseCode")[0].value.length||0===$("#txt_ClientName")[0].value.length||0===$("#txt_PName")[0].value.length||0===$("#txt_VCount")[0].value.length)return void alert("Please fill in all the values before submitting the form");for(var o=0;o<e.length;o++){var r=e[o],s=context.get_web().get_lists().getByTitle("Consent").addItem(new SP.ListItemCreationInformation);if(0!=r[0].length&&0!=r[1].length&&0!=r[2].length){if(!validateEmail(r[0]))return alert(r[0]+" is NOT a valid email address"),!1;s.set_item("Title",r[0]),s.set_item("RName",r[1]),s.set_item("RCompany",r[2]),s.set_item("CaseCode",$("#txt_CaseCode")[0].value.trim()),s.set_item("ClientName",$("#txt_ClientName")[0].value.trim()),s.set_item("ProjectName",$("#txt_PName")[0].value.trim()),"Yes"===$("input:radio[name=Diligence]:checked").val()?s.set_item("VendorDiligence",!0):s.set_item("VendorDiligence",!1),s.update(),t[n]=s,context.load(t[n]),n++,l+=r[0]+"\n"}else{i=!0;var a=!1;alert("Values missing from entry: "+r[0]+" "+r[1]+" "+r[2])}}i===!1&&($("#btn_Send").attr("Value","Sending..."),context.executeQueryAsync(function(){for(var e=t.length-1;e>=0;e--){var n=context.get_web().get_lists().getByTitle("Consent").getItemById(t[e].get_id()),a="?identity="+t[e].get_id(),i=Base64.encode(a);n.set_item("ConsentURL",i),n.update()}context.executeQueryAsync(function(){},function(e,t){$("#btn_Send").attr("Value","Send Email"),$("#btn_Send").attr("disabled","true"),alert("Error creating encrypted URL's... "+t.get_message())})},function(e,t){a=!1,$("#btn_Send").attr("Value","Send Email"),$("#btn_Send").attr("disabled","true"),alert("Error storing data... "+t.get_message())}),a&&($("#txt_CaseCode")[0].value="",$("#txt_ClientName")[0].value="",$("#txt_PName")[0].value="",$("#txt_VCount")[0].value="",$("#btn_Send").attr("Value","Send Email"),$(".hideComp").css("visibility","hidden"),$("#excelControl").empty(),alert("Thank you - request e-mails have been sent to the below recipients asking them to accept Bain's terms. After each recipient has accepted via the system, you will get an e-mail informing you that you can send the report.\n"+l+"\nThank you for using the Bain Report Online Access Authorisation Centre")))}function validateEmail(e){var t=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return t.test(e)}var context=null,currentUser=null,excelTab=null;window.addEventListener("DOMContentLoaded",function(){SP.SOD.executeFunc("sp.js","SP.ClientContext",init)});